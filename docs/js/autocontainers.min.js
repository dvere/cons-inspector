let dbName="containers",dbVersion=1,scanDb={};function processInput(){var n=parseInput()}function parseInput(){for(var n,e=$("#aInput").val().toUpperCase().trim().split("\n").slice(0),t,r=[];void 0!==(barcode=e.shift());)null===barcode.match(/^PCS[0-9]{9}$/)?(void 0===r[barcode]&&(r[barcode]={id:Number(barcode.replace(/\D/g,"")),barcode:barcode,consignments:[]}),t=barcode):(currentConsignment={barcode:barcode,timestamp:$.now()},r[t].consignments.push(currentConsignment));return r}function postConsignment(n,e){var t="/"+n.type+"containers/"+n.barcode+"/scan/"+e;fetch(t,{method:"POST"})}function getContainer(n){$.getJSON("/trunkcontainers/"+n,n=>{console.log(n)})}function autoContainers(){var n=$("<div>",{id:"aForm"}).append($("<textarea>",{id:"aInput"})).append($("<button>",{class:"lt-button",text:"Process"}).click((function(){processInput()}))).append($("<button>",{class:"lt-button",text:"Clear"}).click((function(){$("#aInput").val("")})));$("#ltInsert").empty().append(n),$("#aInput").focus()}scanDb.db=null,scanDb.onerror=n=>{console.log("DB Error: "+n),alert("DB Error: "+n)},scanDb.open=()=>{let n=indexedDB.open(dbName,dbVersion);n.onsuccess=n=>{scanDb.db=n.target.result,scanDb.updateContainers()},n.onupgradeneeded=n=>{scanDb.db=n.target.result,scanDb.db.objectStoreNames.contains("trunk")&&scanDb.db.deleteObjectStore("trunk"),scanDb.db.createObjectStore("trunk",{keyPath:"id"}).createIndex("barcode","barcode",{unique:!0}),scanDb.updateContainers()},n.onerror=n=>{console.log("req error: "+n)}},scanDb.updateContainers=()=>{let n={limit:50,offset:0,order:"-id",origin_service_centre:"SW",status:"all",type:"all"},e="/trunkcontainers/";$.getJSON(e,n).done(n=>{let e=scanDb.db.transaction("trunk","readwrite").objectStore("trunk");$.each(n,(n,t)=>{e.put(t)})})},scanDb.containerAddCons=(n,e)=>{let t=scanDb.db.transaction("trunk","readwrite").objectStore("trunk"),r=t.get(e);r.onsuccess=()=>{let e=r.result;e.consignments.push(n);let o=t.put(e);console.log("The transaction that originated this request is "+o.transaction)}},scanDb.getConsContainer=n=>{},scanDb.removeCons=(n,e)=>{},scanDb.listContainerCons=n=>{},scanDb.addContainer=n=>{},scanDb.removeContainer=n=>{},$.when($.ready).then((function(){autoContainers()}));
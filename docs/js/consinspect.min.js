var url="/consignments/",fields=["tracking_number","requested_route","consolidation_id","location","delivery_address_type","package_type","status","package_type"],data={q:"collected:SW",count:1e3,client_id:11270,fields:fields.join()},cStatus=["RECEIVED SC","COLLECTED","ROUTED","RECONCILED"];function consDetails(e){window.open("/route/#/consignments/"+e+"/details")}function showEvents(e,t){var n=url+e+"/events",a=$("<div>",{id:"cEvents"}),s=$("<h2>",{class:"dlink",text:t}).click((function(){consDetails(e)})),c=$("<table>",{id:"eTable"}),i=$("<thead>",{class:"events-header"});$("#ltInsert").append($("<div>",{id:"cAudits"})),$.each(["Timestamp","SC","Event","User"],(function(e,t){$("<th>",{class:"events-header-item",text:t}).appendTo(i)})),c.append(i),a.append(s).append(c),$("#cAudits").append(a),$.getJSON(n,(function(e){$.each(e,(function(e,t){var n=$("<tr>",{class:"event"});t.service_centre=t.service_centre||{code:"NA"},t.user=t.user||{username:"NA"},$("<td>",{class:"event-item",text:t.timestamp}).appendTo(n),$("<td>",{class:"event-item",text:t.service_centre.code}).appendTo(n),$("<td>",{class:"event-item",text:t.tracking_code.code}).appendTo(n),$("<td>",{class:"event-item",text:t.user.username}).appendTo(n),n.appendTo(c)})),$("#cAudits").fadeIn().click((function(){$(this).remove()}))})).fail((function(){alert("Events Request for "+t+" Failed")}))}function getCollectedCons(){data.received_at=$("#cDate").val(),data.status=$("#cStatus").val(),data.location="SWINDON",$("#cConsignments").remove(),$("<div>",{id:"cLoading"}).appendTo($("#ltInsert")),$("<i>",{class:"ace-icon fa fa-gear fa-spin blue"}).appendTo($("#cLoading")),$.getJSON(url,data,(function(e){if(e.length>0){var t=$("<thead>",{class:"consignments-header"}),n=$("<table>",{id:"cConsignments"}).append(t),a=["Tracking No","Type","Route","Cons. Id","Location","Status"];$.each(a,(function(e,n){$("<th>",{class:"consignments-header-item",text:n}).appendTo(t)})),$("#ltInsert").append(n),$.each(e,(function(e,t){var n=$("<tr>",{class:"consignment"});$("<td>",{class:"consignment-item",text:t.tracking_number,id:t.id}).click((function(){showEvents(t.id,t.tracking_number)})).appendTo(n),$("<td>",{class:"consignment-item",text:t.package_type}).appendTo(n),$("<td>",{class:"consignment-item",text:t.requested_route}).appendTo(n),$("<td>",{class:"consignment-item",text:t.consolidation_id}).appendTo(n),$("<td>",{class:"consignment-item",text:t.location}).appendTo(n),$("<td>",{class:"consignment-item",text:t.status}).appendTo(n),$("#cLoading").remove(),$("#cConsignments").append(n)}))}else $("#cLoading").remove(),$("#ltInsert").append($("<div>",{id:"cConsignments",text:"Lookup returned no consignments."}))})).fail((function(){console.log("Consignments Request Failed")}))}function consInspector(){var e=$("<select>",{id:"cStatus"});$.each(cStatus,(function(t,n){$("<option>",{value:n,text:n}).appendTo(e)}));var t=$("<div>",{id:"cForm"}).append($("<input>",{id:"cDate",type:"date"})).append(e).append($("<button>",{id:"cButton",text:"Look up collections"}).click((function(){getCollectedCons()})));$("#ltInsert").empty().append(t)}$.when($.ready).then((function(){consInspector()}));
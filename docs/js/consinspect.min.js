var e="/consignments/",t={q:"collected:SW",count:1e3,client_id:11270,fields:["tracking_number","requested_route","consolidation_id","location","delivery_address_type","package_type","status","package_type"].join()},n=["RECEIVED SC","COLLECTED","ROUTED","RECONCILED"];function a(t,n){var a=e+t+"/events",i=$("<div>",{id:"cEvents"}),s=$("<h2>",{class:"dlink",text:n}).click((function(){var e;e=t,window.open("/route/#/consignments/"+e+"/details")})),c=$("<table>",{id:"eTable"}),o=$("<thead>",{class:"events-header"});$("#ltInsert").append($("<div>",{id:"cAudits"})),$.each(["Timestamp","SC","Event","User"],(function(e,t){$("<th>",{class:"events-header-item",text:t}).appendTo(o)})),c.append(o),i.append(s).append(c),$("#cAudits").append(i),$.getJSON(a,(function(e){$.each(e,(function(e,t){var n=$("<tr>",{class:"event"});t.service_centre=t.service_centre||{code:"NA"},t.user=t.user||{username:"NA"},$("<td>",{class:"event-item",text:t.timestamp}).appendTo(n),$("<td>",{class:"event-item",text:t.service_centre.code}).appendTo(n),$("<td>",{class:"event-item",text:t.tracking_code.code}).appendTo(n),$("<td>",{class:"event-item",text:t.user.username}).appendTo(n),n.appendTo(c)})),$("#cAudits").fadeIn().click((function(){$(this).remove()}))})).fail((function(){alert("Events Request for "+n+" Failed")}))}function i(){var i=$("<select>",{id:"cStatus"});$.each(n,(function(e,t){$("<option>",{value:t,text:t}).appendTo(i)}));var s=$("<div>",{id:"cForm"}).append($("<input>",{id:"cDate",type:"date"})).append(i).append($("<button>",{id:"cButton",text:"Look up collections"}).click((function(){t.received_at=$("#cDate").val(),t.status=$("#cStatus").val(),t.location="SWINDON",$("#cConsignments").remove(),$("<div>",{id:"cLoading"}).appendTo($("#ltInsert")),$("<i>",{class:"ace-icon fa fa-gear fa-spin blue"}).appendTo($("#cLoading")),$.getJSON(e,t,(function(e){if(e.length>0){var t=$("<thead>",{class:"consignments-header"}),n=$("<table>",{id:"cConsignments"}).append(t);$.each(["Tracking No","Type","Route","Cons. Id","Location","Status"],(function(e,n){$("<th>",{class:"consignments-header-item",text:n}).appendTo(t)})),$("#ltInsert").append(n),$.each(e,(function(e,t){var n=$("<tr>",{class:"consignment"});$("<td>",{class:"consignment-item",text:t.tracking_number,id:t.id}).click((function(){a(t.id,t.tracking_number)})).appendTo(n),$("<td>",{class:"consignment-item",text:t.package_type}).appendTo(n),$("<td>",{class:"consignment-item",text:t.requested_route}).appendTo(n),$("<td>",{class:"consignment-item",text:t.consolidation_id}).appendTo(n),$("<td>",{class:"consignment-item",text:t.location}).appendTo(n),$("<td>",{class:"consignment-item",text:t.status}).appendTo(n),$("#cLoading").remove(),$("#cConsignments").append(n)}))}else $("#cLoading").remove(),$("#ltInsert").append($("<div>",{id:"cConsignments",text:"Lookup returned no consignments."}))})).fail((function(){console.log("Consignments Request Failed")}))})));$("#ltInsert").empty().append(s)}$.when($.ready).then((function(){i()}));